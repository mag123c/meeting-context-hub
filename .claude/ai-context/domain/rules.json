{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "version": "2.3.0",
  "rules": {
    "meeting_summary": {
      "description": "Meeting summary rules",
      "steps": [
        "Input raw meeting transcript text",
        "Extract PRD format summary via Claude API",
        "Extract Action Items via Claude API",
        "Extract suggestedTags via Claude API",
        "Save to Supabase",
        "Generate Obsidian markdown file"
      ],
      "constraints": [
        "PRD must include 4 sections: problem, goal, scope, requirements",
        "Action Items must have at least assignee, task fields",
        "deadline is optional but extract if possible",
        "suggestedTags auto-recommend 3-5 tags"
      ]
    },
    "meeting_edit": {
      "description": "Meeting edit/delete workflow",
      "components": {
        "MeetingActions": "Edit/delete button component",
        "Dialog": "Title/content/tags edit form",
        "AlertDialog": "Delete confirmation"
      },
      "steps": [
        "Click edit button → Open Dialog",
        "Edit title, content, tags (using TagSelector)",
        "Save → PATCH /api/meeting/[id]",
        "Delete → AlertDialog confirm → DELETE /api/meeting/[id]"
      ]
    },
    "tag_editing": {
      "description": "Tag editing workflow",
      "components": {
        "TagSelector": "Tag selection/creation component (Command + Popover)"
      },
      "steps": [
        "Open TagSelector → GET /api/tag for tag list",
        "Input search term → Filter",
        "Select/deselect existing tags (checkbox style)",
        "Create new tag (when search term doesn't match existing) → POST /api/tag",
        "Display selected tags as Badges",
        "onTagsChange callback to parent component"
      ],
      "constraints": [
        "Prevent duplicate tag names (handled by API)",
        "Only name is required for tag creation, description is optional"
      ]
    },
    "sprint_management": {
      "description": "Sprint management workflow",
      "components": {
        "SprintCard": "Sprint list card",
        "SprintForm": "Sprint creation form",
        "SprintStatusControl": "Status change dropdown",
        "ActionItemsSection": "Action items checklist"
      },
      "pages": {
        "/sprints": "Sprint list",
        "/sprints/new": "New sprint creation",
        "/sprints/[id]": "Sprint detail (stats, action items, meetings)"
      },
      "steps": [
        "Select project → Create sprint",
        "Change sprint status (planning → active → completed)",
        "Mark action items complete via checkbox",
        "Link meetings/contexts to sprint"
      ]
    },
    "project_management": {
      "description": "Project management workflow",
      "api_endpoints": {
        "list": "GET /api/project",
        "create": "POST /api/project",
        "get": "GET /api/project/[id]",
        "update": "PATCH /api/project/[id]",
        "delete": "DELETE /api/project/[id]"
      },
      "status_flow": [
        "ideation",
        "active",
        "paused",
        "completed",
        "archived"
      ],
      "steps": [
        "Select squad (optional) → Create project",
        "Create sprints within project",
        "Link meetings/contexts directly to project or through sprint",
        "Change to archived when project completes"
      ]
    },
    "squad_management": {
      "description": "Squad management workflow",
      "api_endpoints": {
        "list": "GET /api/squad",
        "create": "POST /api/squad",
        "get": "GET /api/squad/[id]",
        "update": "PATCH /api/squad/[id]",
        "delete": "DELETE /api/squad/[id]"
      },
      "steps": [
        "Create squad per user (owned by user_id)",
        "Link Slack channel / Notion workspace (optional)",
        "Create/manage projects within squad"
      ],
      "constraints": [
        "On squad delete, child projects/sprints are unlinked (no cascade)",
        "RLS applied based on user_id"
      ]
    },
    "action_item_lifecycle": {
      "description": "Action item lifecycle",
      "status_flow": [
        "pending",
        "in_progress",
        "completed",
        "cancelled"
      ],
      "transitions": {
        "pending": ["in_progress", "cancelled"],
        "in_progress": ["completed", "cancelled", "pending"],
        "completed": ["pending"],
        "cancelled": ["pending"]
      },
      "auto_actions": {
        "completed": "completed_at = NOW()"
      },
      "ui_components": {
        "checkbox": "Click to toggle pending ↔ completed",
        "ActionItemsSection": "Checklist on sprint detail page"
      }
    },
    "data_hierarchy_filtering": {
      "description": "Data hierarchy filtering rules",
      "hierarchy": "Squad → Project → Sprint → Meeting/Context/ActionItem",
      "filter_patterns": {
        "by_squad": "Filter projects by project.squad_id = ? then join",
        "by_project": "sprint.project_id = ? or meeting.project_id = ?",
        "by_sprint": "meeting.sprint_id = ? or action_item.sprint_id = ?"
      },
      "dashboard_views": {
        "all": "Query all by user_id",
        "sprint_filtered": "Meetings/contexts/action items for specific sprint",
        "project_filtered": "All data for specific project"
      }
    },
    "context_tagging": {
      "description": "Context tagging rules",
      "steps": [
        "Input context content",
        "Query existing tag list",
        "Recommend appropriate tags via Claude API (prioritize reusing existing tags)",
        "Create new tag if needed",
        "Save to Supabase",
        "Include tags in Obsidian frontmatter"
      ],
      "constraints": [
        "Prioritize reusing existing tags",
        "Description required when creating new tags",
        "Tag names can be in any language, use hyphens instead of spaces"
      ]
    },
    "sync_process": {
      "description": "External service sync rules",
      "steps": [
        "Fetch data from external service (Slack/Notion)",
        "Format data (messages → text)",
        "Reuse ExtractTagsUseCase",
        "Save as Context + Generate Obsidian file"
      ],
      "slack": {
        "source": "slack",
        "source_id": "channelId",
        "format": "[username] message content"
      },
      "notion": {
        "source": "notion",
        "source_id": "pageId",
        "format": "# Page Title\n\nBlock content"
      }
    },
    "obsidian_format": {
      "description": "Obsidian file format",
      "meeting": {
        "path": "meetings/YYYY-MM-DD-{title}.md",
        "template": "---\ntags: [{tags}]\ndate: {date}\ntype: meeting\n---\n\n# {title}\n\n## PRD Summary\n\n### Problem\n{problem}\n\n### Goal\n{goal}\n\n### Scope\n{scope}\n\n### Requirements\n{requirements}\n\n## Action Items\n\n{action_items}"
      },
      "context": {
        "path": "contexts/{short-title}_{short_id}.md",
        "naming_rules": {
          "format": "{short-title}_{short-id}.md",
          "description": "Short title + collision-preventing short_id",
          "example": "PG-integration-done_a64cbac7.md",
          "sanitization": [
            "Remove special characters: <>:\"/\\|?*.,!?",
            "Remove unnecessary particles/endings (Korean grammar particles)",
            "Replace spaces with hyphens",
            "Max 15 characters (don't cut mid-word)",
            "Maintain compatibility with legacy UUID filenames"
          ]
        },
        "related_links": {
          "description": "Auto-link related documents",
          "threshold": "60% or higher similarity",
          "max_links": 5,
          "format": "## Related Documents\n- [[filename]]"
        },
        "template": "---\nid: {id}\ntags: [{tags}]\ntype: {type}\nsummary: {summary}\nproject: {project}\nsprint: {sprint}\nsource: {source}\nembedding: [{embedding}]\ncreatedAt: {createdAt}\nupdatedAt: {updatedAt}\n---\n\n{content}\n\n## Related Documents\n{related_links}"
      }
    },
    "storage_abstraction": {
      "description": "Storage abstraction rules",
      "principle": "Repository interface → Storage implementation separation",
      "reason": "MVP uses Supabase, future migration to Notion DB possible",
      "pattern": [
        "repositories/{entity}.repository.ts - Interface definition",
        "storage/obsidian/{entity}.obsidian.ts - Obsidian implementation"
      ]
    }
  }
}
