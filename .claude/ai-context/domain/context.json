{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "name": "MCH Domain - Context",
  "version": "2.0",

  "entities": {
    "Context": {
      "description": "A unit of discussion captured and processed by MCH",
      "fields": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier"
        },
        "projectId": {
          "type": "string | null",
          "description": "Associated project, null if uncategorized"
        },
        "rawInput": {
          "type": "string",
          "description": "Original user input text"
        },
        "title": {
          "type": "string",
          "description": "AI-generated title summarizing the context"
        },
        "summary": {
          "type": "string",
          "description": "1-2 sentence summary"
        },
        "decisions": {
          "type": "string[]",
          "description": "List of decisions made"
        },
        "actionItems": {
          "type": "ActionItem[]",
          "description": "Tasks to be done"
        },
        "policies": {
          "type": "string[]",
          "description": "Conventions, rules, policies defined"
        },
        "openQuestions": {
          "type": "string[]",
          "description": "Unresolved questions"
        },
        "tags": {
          "type": "string[]",
          "description": "Auto-generated tags"
        },
        "embedding": {
          "type": "Float32Array | null",
          "description": "Vector embedding for similarity search"
        },
        "createdAt": {
          "type": "Date",
          "description": "Creation timestamp"
        },
        "updatedAt": {
          "type": "Date",
          "description": "Last update timestamp"
        }
      }
    },
    "ActionItem": {
      "description": "A task extracted from context",
      "fields": {
        "task": {
          "type": "string",
          "description": "Task description"
        },
        "assignee": {
          "type": "string | undefined",
          "description": "Person responsible"
        },
        "dueDate": {
          "type": "string | undefined",
          "description": "Due date if mentioned"
        }
      }
    },
    "Project": {
      "description": "A grouping for contexts (squad, team, personal project)",
      "fields": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier"
        },
        "name": {
          "type": "string",
          "description": "Project name, must be unique"
        },
        "description": {
          "type": "string | null",
          "description": "Optional description"
        },
        "createdAt": {
          "type": "Date",
          "description": "Creation timestamp"
        }
      }
    }
  },

  "businessRules": {
    "contextExtraction": {
      "description": "AI extracts structured data from raw input",
      "rules": [
        "Title should be concise (5-10 words)",
        "Summary should be 1-2 sentences",
        "Decisions are explicit agreements or choices",
        "Policies are conventions, rules, or standards",
        "Action items need at least a task description",
        "Tags are auto-generated for categorization"
      ]
    },
    "embedding": {
      "description": "Vector representation for similarity search",
      "rules": [
        "Use OpenAI text-embedding-3-small",
        "Embed title + summary + rawInput truncated",
        "Store as binary BLOB in SQLite"
      ]
    },
    "chaining": {
      "description": "Connecting related contexts",
      "rules": [
        "Use cosine similarity on embeddings",
        "Default threshold: 0.7",
        "Return top 5 related contexts",
        "Exclude self from results"
      ]
    },
    "project": {
      "description": "Project management rules",
      "rules": [
        "Project names must be unique",
        "Deleting project sets contexts to uncategorized",
        "Uncategorized is a virtual project (projectId = null)"
      ]
    }
  },

  "workflows": {
    "addContext": [
      "User enters raw text",
      "AI extracts structured data",
      "Generate embedding",
      "Save to database",
      "Find related contexts",
      "Display result with related items"
    ],
    "search": [
      "User enters search query",
      "Generate query embedding",
      "Calculate similarity with all contexts",
      "Also search keywords in title/summary",
      "Combine and rank results",
      "Display ranked list"
    ],
    "recordContext": [
      "User selects project",
      "User presses SPACE to start recording",
      "Sox captures audio to WAV file",
      "User presses SPACE to stop",
      "Whisper API transcribes audio",
      "User reviews/edits transcription",
      "User presses Ctrl+Enter to submit",
      "AI extracts structured data",
      "Generate embedding",
      "Save to database",
      "Find related contexts",
      "Display result"
    ]
  }
}
