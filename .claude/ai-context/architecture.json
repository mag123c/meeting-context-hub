{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "name": "MCH Architecture",
  "version": "2.0",
  "description": "Meeting Context Hub v2 architecture overview",

  "layers": [
    {
      "name": "TUI",
      "path": "src/tui/",
      "technology": "React + Ink",
      "responsibility": "User interface, input handling, display",
      "components": [
        "App.tsx - Root component, routing",
        "screens/ - Full screen components",
        "components/ - Reusable UI elements",
        "hooks/ - Custom React hooks"
      ]
    },
    {
      "name": "Use Cases",
      "path": "src/core/usecases/",
      "responsibility": "Application business logic orchestration",
      "components": [
        "add-context.usecase.ts",
        "search-context.usecase.ts",
        "list-contexts.usecase.ts",
        "manage-project.usecase.ts",
        "get-context.usecase.ts",
        "record-context.usecase.ts"
      ]
    },
    {
      "name": "Services",
      "path": "src/core/services/",
      "responsibility": "Domain logic implementation",
      "components": [
        "extract.service.ts - AI extraction logic",
        "embedding.service.ts - Text to vector",
        "chain.service.ts - Similarity calculation",
        "config.service.ts - Configuration management"
      ]
    },
    {
      "name": "Domain",
      "path": "src/core/domain/",
      "responsibility": "Domain entities and value objects",
      "components": [
        "context.ts - Context entity",
        "project.ts - Project entity"
      ]
    },
    {
      "name": "Adapters",
      "path": "src/adapters/",
      "responsibility": "External system integration",
      "components": [
        "ai/ - Claude and OpenAI adapters",
        "audio/ - Whisper and Sox recording adapters",
        "storage/ - SQLite adapter",
        "config/ - Environment and file-based config"
      ]
    }
  ],

  "dependencies": {
    "runtime": {
      "@anthropic-ai/sdk": "Claude API client",
      "openai": "OpenAI API client (embedding, whisper)",
      "better-sqlite3": "SQLite database",
      "ink": "React for CLI",
      "react": "UI framework",
      "zod": "Schema validation",
      "dotenv": "Environment variables",
      "uuid": "ID generation"
    },
    "development": {
      "typescript": "Type system",
      "tsx": "TypeScript execution",
      "vitest": "Testing framework",
      "eslint": "Linting"
    }
  },

  "dataFlow": {
    "addContext": [
      "User input text",
      "TUI -> AddContextUseCase",
      "UseCase -> ExtractService (Claude)",
      "UseCase -> EmbeddingService (OpenAI)",
      "UseCase -> StorageAdapter (SQLite)",
      "UseCase -> ChainService (find related)",
      "Return result to TUI"
    ],
    "searchContext": [
      "User search query",
      "TUI -> SearchContextUseCase",
      "UseCase -> EmbeddingService (query embedding)",
      "UseCase -> StorageAdapter (all embeddings)",
      "UseCase -> ChainService (cosine similarity)",
      "Return ranked results to TUI"
    ],
    "recordContext": [
      "User starts recording (SPACE)",
      "RecordingAdapter captures audio",
      "User stops recording (SPACE)",
      "WhisperAdapter transcribes audio",
      "User reviews/edits transcription",
      "ExtractService extracts context",
      "EmbeddingService generates embedding",
      "StorageAdapter saves",
      "ChainService finds related",
      "Return result to TUI"
    ]
  },

  "patterns": {
    "architecture": "Clean Architecture",
    "di": "Constructor injection",
    "errorHandling": "Custom MCHError with error codes",
    "testing": "Unit tests for services, integration for adapters"
  }
}
